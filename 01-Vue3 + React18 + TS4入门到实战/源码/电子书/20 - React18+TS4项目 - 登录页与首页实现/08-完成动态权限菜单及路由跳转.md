# 完成动态权限菜单及路由跳转

## 动态权限菜单

首先在路由表中扩展菜单的配置信息。

```typescript
import React, { lazy } from "react";
import { createBrowserRouter, Navigate } from "react-router-dom";
import type { RouteObject } from "react-router-dom";
import {
  CopyOutlined,
  CalendarOutlined,
  WarningOutlined,
  FileAddOutlined,
  ScheduleOutlined,
} from '@ant-design/icons'
const Home = lazy(()=> import('../views/Home/Home'))
const Sign = lazy(()=> import('../views/Sign/Sign'))
const Exception = lazy(()=> import('../views/Exception/Exception'))
const Apply = lazy(()=> import('../views/Apply/Apply'))
const Check = lazy(()=> import('../views/Check/Check'))
const Login = lazy(()=> import('../views/Login/Login'))
const BeforeEach = lazy(()=> import('../components/BeforeEach/BeforeEach'))
declare module 'react-router' {
  interface IndexRouteObject {
    meta?: {
      menu?: boolean
      title?: string
      icon?: React.ReactNode 
      auth?: boolean
    },
    name?: string
  }
  interface NonIndexRouteObject {
    meta?: {
      menu?: boolean
      title?: string
      icon?: React.ReactNode  
      auth?: boolean
    },
    name?: string
  }
}
export const routes: RouteObject[] = [
  {
    path: '/',
    element: React.createElement(Navigate, {to: '/sign'})
  },
  {
    path: '/',
    name: 'home',
    element: React.createElement(BeforeEach, null, React.createElement(Home)),
    meta: {
      menu: true,
      title: '考勤管理',
      icon: React.createElement(CopyOutlined),
      auth: true
    },
    children: [
      {
        path: 'sign',
        name: 'sign',
        element: React.createElement(Sign),
        meta: {
          menu: true,
          title: '在线打卡签到',
          icon: React.createElement(CalendarOutlined),
          auth: true
        }
      },
      {
        path: 'exception',
        name: 'exception',
        element: React.createElement(Exception),
        meta: {
          menu: true,
          title: '异常考勤查询',
          icon: React.createElement(WarningOutlined),
          auth: true,
        }
      },
      {
        path: 'apply',
        name: 'apply',
        element: React.createElement(Apply),
        meta: {
          menu: true,
          title: '添加考勤审批',
          icon: React.createElement(FileAddOutlined),
          auth: true,
        }
      },
      {
        path: 'check',
        name: 'check',
        element: React.createElement(Check),
        meta: {
          menu: true,
          title: '我的考勤审批',
          icon: React.createElement(ScheduleOutlined),
          auth: true,
        }
      }
    ]
  },
  {
    path: '/login',
    element: React.createElement(BeforeEach, null, React.createElement(Login))
  }
];
const router = createBrowserRouter(routes)
export default router;
```

接下来就是在<HomeAside>组件中引入动态菜单。

```tsx
import React from 'react'
import { Menu } from 'antd'
import type { MenuProps } from 'antd';
import styles from '../Home.module.scss'
import { routes } from '../../../router';
import { useSelector } from 'react-redux';
import type { RootState } from '../../../store';
import _ from 'lodash'
import { useLocation, matchRoutes, Link } from 'react-router-dom'
export default function HomeAside() {
  const permission = useSelector((state: RootState)=> state.users.infos.permission) as unknown[]
  const location = useLocation()
  const matchs = matchRoutes(routes, location)
  const subPath = matchs![0].pathnameBase || '';
  const path = matchs![1].pathnameBase || '';
  const menus = _.cloneDeep(routes).filter((v)=> {
    v.children = v.children?.filter((v)=> v.meta?.menu && permission.includes(v.name))
    return v.meta?.menu && permission.includes(v.name)
  })
  const items: MenuProps['items'] = menus.map((v1)=>{
    const children = v1.children?.map((v2)=>{
      return {
        key: v1.path! + v2.path!,
        label: <Link to={v1.path! + v2.path!}>{v2.meta?.title}</Link>,
        icon: v2.meta?.icon
      }
    })
    return {
      key: v1.path!,
      label: v1.meta?.title,
      icon: v1.meta?.icon,
      children
    }
  })
  return (
    <Menu
      defaultSelectedKeys={[path]}
      defaultOpenKeys={[subPath]}
      mode="inline"
      items={items}
      className={styles['home-aside']}
    />
  )
}
```

这样就可以根据不同的角色，渲染不同的菜单项了。

